{% extends "base.html" %}

{% block content %}
<div>
    <h3>{{ place.place_name }}</h3>
    <p>{{ place.address }}</p>
    <img src="{{ place.photo_url }}" alt="Photo of {{ place.place_name }}">
    <!-- <p>Submitted by {{ place.contributer }} on {{ place.created_on|date:"d/m/y" }}</p> -->
    <br>

    {% if user.is_authenticated %}

    <form action="{% url 'favourite_a_place' place.pk %}" method="POST">
        {% csrf_token %}
        {% if user_has_favourited %}
        <button type="submit" name="place_id" value="{{place.id}}">FAVOURITED</button>
        {% else %}
        <button type="submit" name="place_id" value="{{place.id}}">NOT FAVOURITED</button>
        {% endif %}
    </form>

    {% else %}
    <h5>[Favourited Button for not signed in users]</h5>
    {% endif %}


    {% if user.is_authenticated and user == place.contributer %}
    <p>As the original contributer, you can</p><a href="{% url 'place_edit' place.pk %}">+ Edit This Place +</a>
    {% endif %}

    {% if favourite_place.comments.count == 1 %}
            <h4>({{ place.comments.count }} Comment)</h4>
            <hr>
        <!-- "Comment" (not plural) if only 1 comment -->
    {% else %}
            <h4>({{ place.comments.count }} Comments)</h4>
            <hr>
    {% endif %}

    {% for comment in place.comments.all %}
    <h5>{{ comment.author }} â€¢ {{ comment.created_on|date:"d/m/y H:i" }}</h5>
    <p>{{ comment.comment }}</p>
    {% if user.is_authenticated and user == comment.author %}
    <p>As the original author, you can</p><a href="{% url 'comment_edit' comment.pk %}">+ Edit This Comment +</a>
    <p>As the original author, you can</p><a href="{% url 'comment_delete' comment.pk %}">+ Delete This Comment +</a>
    {% endif %}
    <hr>
    {% endfor %}

    {% if user.is_authenticated %}
    <h4>Add a Comment:</h4>

    <form action="" method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Submit</button>
        <button><a href="{% url 'place_detail' place.pk %}">Cancel</a></button>
    </form>
    {% endif %}
</div>

{% endblock content %}